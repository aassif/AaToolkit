################################################################################
# Compilateur ##################################################################
################################################################################

GCC_DEFAULT=    g++ -fPIC -W -Wall -pedantic
GCC_DEBUG=      $(GCC_DEFAULT) -O0 -ggdb3 -pg
GCC_RELEASE=    $(GCC_DEFAULT) -O3 -ggdb3
#GCC=            $(GCC_DEBUG)
GCC=            $(GCC_RELEASE)

################################################################################
# Chemins ######################################################################
################################################################################

# AaToolkit ####################################################################

V_AaToolkit=    AaToolkit-0.0.1
H_AaToolkit=    include
S_AaToolkit=    src
D_AaToolkit=    doc
I_AaToolkit=    -I$(H_AaToolkit)

################################################################################
# Variables ####################################################################
################################################################################

HDR=            $(wildcard $(H_AaToolkit)/*.h $(H_AaToolkit)/*.hh)
SRC=            $(wildcard $(S_AaToolkit)/*.cc)
OBJ=            $(SRC:%.cc=%.o)
LIB=            lib/libAaToolkit
STATIC=         $(LIB).a
SHARED=         $(LIB).so
ALL=            make.depend $(STATIC) $(SHARED)

################################################################################
# Règles #######################################################################
################################################################################

all:            $(ALL)
#								echo $(HDR)
								make -i -C bin

$(STATIC):      make.depend $(OBJ)
								ar rcs $(STATIC) $(OBJ)

$(SHARED):      make.depend $(OBJ)
								$(GCC) -shared $(OBJ) -o $(SHARED)

%.o:            %.cc
								$(GCC) -c $(I_AaToolkit) $< -o $@

################################################################################
# Ménage #######################################################################
################################################################################

doxygen:                
								rm -f $(D_AaToolkit)/*
								doxygen doxygen.cfg

clean:
								make -C bin clean
								rm -f $(D_AaToolkit)/*
								rm -f $(OBJ) $(ALL)
#								find . -name "*~" -exec rm {} \;

archive:        clean
								tar zcvf ~/tgz/$(V_AaToolkit).tgz *

################################################################################
# Dépendances ##################################################################
################################################################################

dep:
								$(GCC) -MM $(I_AaToolkit) $(SRC) >make.depend

make.depend:    $(HDR) $(SRC)
								$(GCC) -MM $(I_AaToolkit) $(SRC) >make.depend

include make.depend

